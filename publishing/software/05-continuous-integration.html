

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Continuous integration &#8212; NRDG Standard Operating Procedures</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/spanels-index--0afa1ebdab0bb23b98b56d34c23d9f57.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/spanels-variables--ffc7f74dcb1b9eecba2dbcbc22818714.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">NRDG Standard Operating Procedures</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Standard Operating Procedures
  </a>
 </li>
</ul>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../general/general.html">
   General information
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../comms/comms.html">
   Communication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../infra/infra.html">
   Infrastructure
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/publishing/software/05-continuous-integration.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            
        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="continuous-integration">
<h1>Continuous integration<a class="headerlink" href="#continuous-integration" title="Permalink to this headline">¶</a></h1>
<p>Having tests is nice. But tests are not useful unless you run them. And you’d
ideally like to run them often. Continuous integration (CI) means that you have
systems in place that automatically run the tests for you every time that
changes are made to the software.</p>
<p>Here, we will use GitHub’s built-in system for CI called GitHub Actions. The
system is actually very flexible and can allow you to configure GitHub to
run a variety of different operations triggered on a large range of events
in your repository (including regularly scheduled “cron” jobs).</p>
<p>GitHub Actions works by reading configuration files that are stored in a special
directory in your repository in <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code>. These files are written
in the YAML markup language.</p>
<p>Here, we’ll use a pre-configured workflow for Python packages and change it
slightly for our purposes. GitHub allows you to edit files through the browser
and we will use this capability to edit the pre-configured configuration to
do what want it to do. To do so, we click through the Actions menu and choose
the “Python Package” action. This will open the editor and allow us to tweak.</p>
<p>We’ll tweak the following items:</p>
<ul class="simple">
<li><p>The versions of Python tested: we’ll use only 3.6 and 3.7. Remember that we
set the software up to require version after 3.6</p></li>
<li><p>Install the software with <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code>. There are other ways to
install software, but will not consider them here. For more on that, you can
look <a class="reference external" href="https://pip.pypa.io/en/stable/">here</a></p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--doctest-modules</span> <span class="pre">geometry</span></code> to emulate what we did locally.</p></li>
</ul>
<p>In the end the configuration will look like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>name: Python package

on:
push:
    branches: [ master ]
pull_request:
    branches: [ master ]

jobs:
build:

    runs-on: ubuntu-latest
    strategy:
    matrix:
        python-version: [3.6, 3.7]

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python ${{ matrix.python-version }}
    uses: actions/setup-python@v2
    with:
        python-version: ${{ matrix.python-version }}
    - name: Install
    run: |
        python -m pip install --upgrade pip
        pip install pytest flake8
        python setup.py install
    - name: Lint with flake8
    run: |
        # stop the build if there are Python syntax errors or undefined names
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
    - name: Test with pytest
    run: |
        pytest --doctest-modules geometry
</pre></div>
</div>
<p>Once the workflow is commited to the repository, this workflow is triggered and
the steps in the configuration file are executed. Note that in addition to
running our tests, this configuration runs flake8, which checks the code for its
compliance with standards for formatting, and other best practices in how the
code is constructed. Given feedback from the CI system, we might need to address
some of these issues, before we can move on. But once the CI is all green, we
can see how this works in practice. Consider what happens when a new piece of
code is added.</p>
<p>Here, we will make a new branch, called <code class="docutils literal notranslate"><span class="pre">new_test</span></code> and add a test for the other
function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_circ</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the circumference of a circle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r : float or array</span>
<span class="sd">        The radius of a single circle or multiple circles</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    circ : float or array</span>
<span class="sd">        The calculated circumference/s</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; calculate_circ(1)</span>
<span class="sd">    3.141592653589793</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">circ</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">circ</span>
</pre></div>
</div>
<p>Let’s commit this code and see what kind of feedback we get. We go through the
process: commit the code, push it to GitHub and make a pull request. After a
short while, we get our feedback back. We will also get an email telling us
that the test failed. Fixing the code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># snip</span>

    <span class="n">Examples</span>
    <span class="o">--------</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">calculate_circ</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="mf">6.283185307179586</span>

<span class="c1"># snip</span>
</pre></div>
</div>
<p>And committing then pushing the code to GitHub now fixes the CI. Once the CI is
green, we can safely merge the PR. This pattern can save you a lot of pain. It
is much better to prevent errors from being introduced in the first place, than
to try fixing errors after they have already broken your software.</p>
<p>This is a good pattern to use yourself, but it becomes crucial when you are
collaborating with others. This is because it lets you vet new additions by
others in an automated manner. If you keep all of your code tested in this way,
it will also tell you when a new contribution is breaking existing functionality
of the software.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./publishing/software"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Neuroinformatics R&D Group (NRDG)<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>